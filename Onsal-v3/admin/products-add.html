<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ürün Ekle - Onsal Elektronik Yönetim Paneli</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/admin.css">
    <style>
        /* Ürün ekleme sayfasına özel stiller */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            color: var(--danger-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .char-counter {
            font-size: 12px;
            color: #6c757d;
            text-align: right;
            margin-top: 5px;
        }
        
        .property-item {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .property-item .form-control {
            flex: 1;
        }
        
        .property-item .btn {
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Onsal Elektronik</h2>
                <p>Yönetim Paneli</p>
            </div>
            
            <ul class="sidebar-menu">
                <li class="sidebar-menu-item" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                
                <li class="sidebar-menu-item active" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Ürünler</span>
                    <i class="fas fa-chevron-down submenu-toggle"></i>
                    
                <ul class="sidebar-submenu open">
                    <li class="sidebar-submenu-item" data-page="products-list">
                        <i class="fas fa-list"></i>
                        <span>Ürün Listesi</span>
                    </li>
                    <li class="sidebar-submenu-item active" data-page="products-add">
                        <i class="fas fa-plus"></i>
                        <span>Ürün Ekle</span>
                    </li>
                    <li class="sidebar-submenu-item" data-page="products-categories">
                        <i class="fas fa-tags"></i>
                        <span>Kategoriler</span>
                    </li>
                </ul>
                </li>
                
                <li class="sidebar-menu-item" data-page="banners">
                    <i class="fas fa-images"></i>
                    <span>Banner Yönetimi</span>
                </li>
                
                <li class="sidebar-menu-item" data-page="pages">
                    <i class="fas fa-file-alt"></i>
                    <span>Sayfalar</span>
                </li>
                
                <li class="sidebar-menu-item" data-page="seo">
                    <i class="fas fa-search"></i>
                    <span>SEO Ayarları</span>
                </li>
                
                <li class="sidebar-menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Ayarlar</span>
                </li>
            </ul>
            
            <button class="sidebar-toggle" id="sidebar-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title">Ürün Ekle</h1>
                </div>
                
                <div class="header-right">
                    <div class="header-user">
                        <div class="header-user-avatar">
                            <img src="https://ui-avatars.com/api/?name=Admin&background=3498db&color=fff" alt="Admin">
                        </div>
                        <span class="header-user-name">Admin</span>
                        <i class="fas fa-chevron-down"></i>
                        
                        <div class="header-user-dropdown" id="user-dropdown">
                            <a href="#" class="header-user-dropdown-item">
                                <i class="fas fa-user"></i>
                                <span>Profil</span>
                            </a>
                            <a href="#" class="header-user-dropdown-item" id="logout-button">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Çıkış Yap</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Yeni Ürün Ekle</h2>
                        <div class="card-actions">
                            <a href="products-list.html" class="btn btn-light">
                                <i class="fas fa-arrow-left"></i> Listeye Dön
                            </a>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <form id="product-form">
                            <!-- Tabs -->
                            <div class="tabs">
                                <div class="tab-item active" data-tab="general">
                                    <i class="fas fa-info-circle"></i> Genel Bilgiler
                                </div>
                                <div class="tab-item" data-tab="images">
                                    <i class="fas fa-images"></i> Görseller
                                </div>
                                <div class="tab-item" data-tab="details">
                                    <i class="fas fa-list-ul"></i> Detaylar
                                </div>
                                <div class="tab-item" data-tab="seo">
                                    <i class="fas fa-search"></i> SEO
                                </div>
                            </div>
                            
                            <!-- Tab Content 1: Genel Bilgiler -->
                            <div class="tab-content active" id="tab-general">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="product-name">Ürün Adı <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="product-name" name="product-name" required>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="product-category">Kategori <span class="text-danger">*</span></label>
                                            <select class="form-control" id="product-category" name="product-category" required>
                                            <option value="">Kategori Seçin</option>
                                                <option value="Televizyon">Televizyon</option>
                                                <option value="Beyaz Eşya">Beyaz Eşya</option>
                                                <option value="Küçük Ev Aletleri">Küçük Ev Aletleri</option>
                                                <option value="Kişisel Bakım">Kişisel Bakım</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                            <label for="product-brand">Marka</label>
                                            <select class="form-control" id="product-brand" name="product-brand">
                                            <option value="">Marka Seçin</option>
                                                <option value="1">Samsung</option>
                                                <option value="2">LG</option>
                                                <option value="3">Arçelik</option>
                                                <option value="4">Beko</option>
                                                <option value="5">Philips</option>
                                                <option value="6">Braun</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                            <label for="product-price">Fiyat (TL) <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="product-price" name="product-price" min="0" step="0.01" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="product-discount">İndirim Oranı (%)</label>
                                            <input type="number" class="form-control" id="product-discount" name="product-discount" min="0" max="100" value="0">
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                            <label for="product-stock">Stok Miktarı <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="product-stock" name="product-stock" min="0" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <label for="product-short-desc">Kısa Açıklama</label>
                                    <textarea class="form-control" id="product-short-desc" name="product-short-desc" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                    <label for="product-status">Durum</label>
                                    <select class="form-control" id="product-status" name="product-status">
                                        <option value="1">Aktif</option>
                                        <option value="0">Pasif</option>
                                    </select>
                            </div>
                            </div>
                            
                            <!-- Tab Content 2: Görseller -->
                            <div class="tab-content" id="tab-images">
                            <div class="form-group">
                                    <label>Ana Görsel <span class="text-danger">*</span></label>
                                    <div class="image-upload">
                                        <input type="file" id="main-image" name="main-image" class="image-upload-input" accept="image/*">
                                        <label for="main-image" class="image-upload-label">
                                            <div class="image-upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                            </div>
                                            <div class="image-upload-text">
                                                Görsel yüklemek için tıklayın veya sürükleyin
                                            </div>
                                        </label>
                                        <div class="image-preview-container" id="main-image-preview"></div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Galeri Görselleri</label>
                                    <div class="image-upload">
                                        <input type="file" id="gallery-images" name="gallery-images" class="image-upload-input" accept="image/*" multiple>
                                        <label for="gallery-images" class="image-upload-label">
                                            <div class="image-upload-icon">
                                                <i class="fas fa-images"></i>
                                            </div>
                                            <div class="image-upload-text">
                                                Birden fazla görsel yüklemek için tıklayın veya sürükleyin
                                            </div>
                                        </label>
                                        <div class="image-preview-container" id="gallery-images-preview"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab Content 3: Detaylar -->
                            <div class="tab-content" id="tab-details">
                                    <div class="form-group">
                                    <label for="product-description">Detaylı Açıklama</label>
                                    <textarea class="form-control" id="product-description" name="product-description" rows="8"></textarea>
                                </div>
                                
                                    <div class="form-group">
                                    <label>Ürün Özellikleri</label>
                                    <div id="product-properties">
                                        <div class="property-item">
                                            <input type="text" class="form-control" name="property-name[]" placeholder="Özellik Adı (Örn: Ekran Boyutu)">
                                            <input type="text" class="form-control" name="property-value[]" placeholder="Değer (Örn: 55 inç)">
                                            <button type="button" class="btn btn-danger property-remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button type="button" class="btn btn-primary" id="add-property">
                                            <i class="fas fa-plus"></i> Özellik Ekle
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tab Content 4: SEO -->
                            <div class="tab-content" id="tab-seo">
                            <div class="form-group">
                                    <label for="product-seo-url">SEO URL</label>
                                    <input type="text" class="form-control" id="product-seo-url" name="product-seo-url">
                                    <div class="form-text">Boş bırakılırsa otomatik oluşturulacaktır.</div>
                                </div>
                                
                                        <div class="form-group">
                                    <label for="product-seo-title">SEO Başlığı</label>
                                    <input type="text" class="form-control" id="product-seo-title" name="product-seo-title" maxlength="70">
                                    <div class="char-counter"><span id="seo-title-count">0</span>/70</div>
                                        </div>
                                        
                                        <div class="form-group">
                                    <label for="product-seo-desc">SEO Açıklaması</label>
                                    <textarea class="form-control" id="product-seo-desc" name="product-seo-desc" rows="3" maxlength="160"></textarea>
                                    <div class="char-counter"><span id="seo-desc-count">0</span>/160</div>
                                        </div>
                                        
                                        <div class="form-group">
                                    <label for="product-seo-keywords">Anahtar Kelimeler</label>
                                    <input type="text" class="form-control" id="product-seo-keywords" name="product-seo-keywords">
                                    <div class="form-text">Virgül ile ayırarak yazın</div>
                                </div>
                            </div>
                            
                            <div class="form-group mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save"></i> Ürünü Kaydet
                                </button>
                                <button type="button" class="btn btn-light btn-lg" id="cancel-button">
                                    <i class="fas fa-times"></i> İptal
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>&copy; 2024 Onsal Elektronik. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </div>
    
    <script src="../js/upload-handler.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Giriş kontrolü
            if (!localStorage.getItem('adminLoggedIn')) {
                window.location.href = 'index.html';
                return;
            }
            
            // ŞİMDİYE KADAR EN BASİT, EN DOĞRUDAN MENÜ KODU
            // Her menü öğesine doğrudan hrefs ekleyerek çalışmasını sağlıyoruz
            
            // 1. Tüm ana menü öğelerine href özelliği ekle
            document.querySelectorAll('.sidebar-menu-item').forEach(function(item) {
                if (item.classList.contains('active')) return; // Aktif öğeyi atla
                
                const page = item.getAttribute('data-page');
                if (page) {
                    item.style.cursor = "pointer";
                    
                    // Alt menü varsa farklı davran
                    if (item.querySelector('.sidebar-submenu')) {
                        item.addEventListener('click', function(e) {
                            // Alt menü butonuna tıklandıysa açılıp kapanma
                            if (e.target.classList.contains('submenu-toggle') || 
                                e.target.closest('.submenu-toggle')) {
                                e.preventDefault();
                                e.stopPropagation();
                                const submenu = this.querySelector('.sidebar-submenu');
                                submenu.classList.toggle('open');
                                return;
                            }
                            
                            // Alt öğeye tıklanmışsa işlem yapma
                            if (e.target.closest('.sidebar-submenu-item')) return;
                            
                            // Ana menüye tıklandığında alt menüyü aç/kapat
                            const submenu = this.querySelector('.sidebar-submenu');
                            submenu.classList.toggle('open');
                        });
                    } else {
                        // Alt menüsü yoksa direkt sayfaya git
                        item.addEventListener('click', function(e) {
                            window.location.href = page + '.html';
                        });
                    }
                }
            });
            
            // 2. Tüm alt menü öğelerine click event ekle
            document.querySelectorAll('.sidebar-submenu-item').forEach(function(item) {
                if (item.classList.contains('active')) return; // Aktif öğeyi atla
                
                const page = item.getAttribute('data-page');
                if (page) {
                    item.style.cursor = "pointer";
                    
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        window.location.href = page + '.html';
                    });
                }
            });
            
            // 3. Alt menü aç/kapat iconları (chevron)
            document.querySelectorAll('.submenu-toggle').forEach(function(toggle) {
                toggle.style.cursor = "pointer";
                
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const menuItem = this.closest('.sidebar-menu-item');
                    const submenu = menuItem.querySelector('.sidebar-submenu');
                    submenu.classList.toggle('open');
                });
            });
            
            // ---- SİDEBAR VE KULLANICI MENÜSÜ ----
            // Sidebar Toggle - basit tutuyoruz
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (sidebarToggle && sidebar && mainContent) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('expanded');
                });
            }
            
            // Kullanıcı Dropdown
            const headerUser = document.querySelector('.header-user');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (headerUser && userDropdown) {
                headerUser.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('show');
                });
                
                // Sayfa herhangi bir yerine tıklandığında dropdown'ı kapat
                document.addEventListener('click', function(e) {
                    if (userDropdown && !headerUser.contains(e.target)) {
                        userDropdown.classList.remove('show');
                    }
                });
            }
            
            // Çıkış Yap
            const logoutButton = document.getElementById('logout-button');
            
            if (logoutButton) {
                logoutButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminUsername');
                    localStorage.removeItem('adminLastLogin');
                    window.location.href = 'index.html';
                });
            }
            
            // ---- ÜRÜN EKLE SAYFASI FONKSİYONLARI ----
            
            // TAB / SEKME DEĞİŞTİRME - YENİDEN YAZILMIŞ, ÇOK DAHA BASİT VE DOĞRUDAN
            function setupTabs() {
                const tabNavItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                
                // İlk sekmeyi aktif yap
                if (tabNavItems.length > 0) {
                    tabNavItems[0].classList.add('active');
                }
                
                if (tabContents.length > 0) {
                    tabContents[0].classList.add('active');
                }
                
                // Her sekme için olay dinleyici ekle
                tabNavItems.forEach(function(tab) {
                    tab.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Tüm sekmelerin active sınıfını kaldır
                        tabNavItems.forEach(function(item) {
                            item.classList.remove('active');
                        });
                        
                        // Tıklanan sekmeyi aktif yap
                        this.classList.add('active');
                        
                        // İlgili içeriği göster
                        const targetId = this.getAttribute('data-tab');
                        if (targetId) {
                            // Tüm içerikleri gizle
                            tabContents.forEach(function(content) {
                                content.classList.remove('active');
                            });
                            
                            // Hedeflenen içeriği göster
                            const targetContent = document.getElementById('tab-' + targetId);
                            if (targetContent) {
                                targetContent.classList.add('active');
                            }
                        }
                    });
                });
            }
            
            // Sekmeleri ayarla
            setupTabs();
            
            // Resim Yükleme
            function setupImageUpload() {
                // Ana görsel yükleme
                const mainImageInput = document.getElementById('main-image');
                const mainImagePreview = document.getElementById('main-image-preview');
                
                if (mainImageInput && mainImagePreview) {
                    // Resim yükleme olayını dinle
                    mainImageInput.addEventListener('change', async function() {
                        if (this.files && this.files[0]) {
                            const file = this.files[0];
                            
                            // Upload Handler kullanarak dosya yükleme
                            const result = await UploadHandler.uploadFile(file, 'products');
                            
                            if (result.success) {
                                // Önizleme oluşturma
                                mainImagePreview.innerHTML = `
                                    <div class="image-preview-item">
                                        <img src="${result.filePath}" alt="Ana Görsel" data-path="${result.filePath}">
                                        <button type="button" class="image-preview-remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                `;
                                
                                // Resmi kaldırma işlevi
                                mainImagePreview.querySelector('.image-preview-remove').addEventListener('click', function() {
                                    mainImagePreview.innerHTML = '';
                                    mainImageInput.value = '';
                                });
                            } else {
                                alert('Ana görsel yüklenirken bir hata oluştu: ' + result.error);
                            }
                        }
                    });
                }
                
                // Galeri resimleri yükleme
                const galleryImagesInput = document.getElementById('gallery-images');
                const galleryImagesPreview = document.getElementById('gallery-images-preview');
                
                if (galleryImagesInput && galleryImagesPreview) {
                    // Resim yükleme olayını dinle
                    galleryImagesInput.addEventListener('change', async function() {
                        if (this.files && this.files.length > 0) {
                            // Her bir dosyayı yükle
                            for (let i = 0; i < this.files.length; i++) {
                                const file = this.files[i];
                                
                                // Upload Handler kullanarak dosya yükleme
                                const result = await UploadHandler.uploadFile(file, 'products');
                                
                                if (result.success) {
                                    const previewItem = document.createElement('div');
                                    previewItem.className = 'image-preview-item';
                                    previewItem.innerHTML = `
                                        <img src="${result.filePath}" alt="Galeri Görseli" data-path="${result.filePath}">
                                        <button type="button" class="image-preview-remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    `;
                                    
                                    galleryImagesPreview.appendChild(previewItem);
                                    
                                    // Resmi kaldırma işlevi
                                    previewItem.querySelector('.image-preview-remove').addEventListener('click', function() {
                                        previewItem.remove();
                                    });
                                } else {
                                    alert(`Galeri görseli yüklenirken bir hata oluştu: ${result.error}`);
                                }
                            }
                            
                            // Input'u temizle (yeni dosya seçimini kolaylaştırmak için)
                            galleryImagesInput.value = '';
                        }
                    });
                }
            }
            
            // Resim yükleme ayarla
            setupImageUpload();
            
            // Ürün Ekleme Formu
            const addProductForm = document.getElementById('product-form');
            
            if (addProductForm) {
                addProductForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Form verilerini al
                    const productId = document.getElementById('product-id').value || Date.now().toString();
                    const productName = document.getElementById('product-name').value;
                    const productCategory = document.getElementById('product-category').value;
                    const productPrice = document.getElementById('product-price').value;
                    const productStock = document.getElementById('product-stock').value;
                    const productStatus = document.getElementById('product-status').value;
                    const productShortDesc = document.getElementById('product-short-desc').value;
                    const productDescription = document.getElementById('product-description').value;
                    
                    // Ürün nesnesi oluştur
                    const product = {
                        id: productId,
                        name: productName,
                        category: productCategory,
                        price: productPrice,
                        stock: productStock,
                        status: parseInt(productStatus), // String yerine number olarak kaydet
                        shortDescription: productShortDesc,
                        description: productDescription,
                        createdAt: new Date().toISOString(),
                        images: [],
                        // SEO alanları
                        seoTitle: document.getElementById('product-seo-title').value || productName,
                        seoDescription: document.getElementById('product-seo-desc').value || productShortDesc,
                        seoKeywords: document.getElementById('product-seo-keywords').value || ''
                    };
                    
                    // Ana görsel
                    const mainImg = document.getElementById('main-image-preview').querySelector('img');
                    if (mainImg) {
                        product.images.push(mainImg.src);
                    }
                    
                    // Galeri görselleri
                    const galleryImgsPreview = document.getElementById('gallery-images-preview');
                    if (galleryImgsPreview) {
                        galleryImgsPreview.querySelectorAll('img').forEach(function(img) {
                            product.images.push(img.src);
                        });
                    }
                    
                    // Mevcut ürünleri al veya yeni liste oluştur
                    console.log("Ürün kaydetme işlemi başlıyor", product);
                    let products = [];
                    const savedProducts = localStorage.getItem('productsList');
                    
                    if (savedProducts) {
                        products = JSON.parse(savedProducts);
                    }
                    
                    // Düzenleme modu mu kontrol et
                    const urlParams = new URLSearchParams(window.location.search);
                    const editId = urlParams.get('edit');
                    
                    if (editId) {
                        // Ürünü güncelle
                        const productIndex = products.findIndex(p => p.id.toString() === editId);
                        
                        if (productIndex !== -1) {
                            products[productIndex] = product;
                            
                            // Ürünü başarıyla güncellendi mesajı göster
                            alert('Ürün başarıyla güncellendi!');
                        }
                    } else {
                        // Yeni ürün ekle
                        products.push(product);
                        
                        // Ürün başarıyla eklendi mesajı göster
                        alert('Ürün başarıyla eklendi!');
                    }
                    
                    // localStorage'a kaydet
                    localStorage.setItem('productsList', JSON.stringify(products));
                    console.log("Ürünler localStorage'a kaydedildi", products);
                    
                    // Ürün listesine yönlendir
                    window.location.href = 'products-list.html?added=success';
                });
            }
            
            // Sayfanın düzenleme modunda olup olmadığını kontrol et
            function checkEditMode() {
                const urlParams = new URLSearchParams(window.location.search);
                const editId = urlParams.get('edit');
                
                if (editId) {
                    // Ürünleri localStorage'dan al
                    const savedProducts = localStorage.getItem('productsList');
                    
                    if (savedProducts) {
                        const products = JSON.parse(savedProducts);
                        const product = products.find(p => p.id.toString() === editId);
                        
                        if (product) {
                            // Başlığı güncelle
                            document.querySelector('.card-title').textContent = 'Ürün Düzenle';
                            
                            // Form alanlarını doldur
                            document.getElementById('product-name').value = product.name;
                            document.getElementById('product-category').value = product.category;
                            document.getElementById('product-price').value = product.price;
                            document.getElementById('product-stock').value = product.stock;
                            document.getElementById('product-status').value = product.status === 1 || product.status === true ? "1" : "0";
                            document.getElementById('product-short-desc').value = product.shortDescription || '';
                            document.getElementById('product-description').value = product.description || '';
                            document.getElementById('product-seo-title').value = product.seoTitle || '';
                            document.getElementById('product-seo-desc').value = product.seoDescription || '';
                            document.getElementById('product-seo-keywords').value = product.seoKeywords || '';
                            
                            // Resimleri yükle
                            if (product.images && product.images.length > 0) {
                                // Ana görsel
                                const mainImagePreview = document.getElementById('main-image-preview');
                                if (mainImagePreview && product.images.length > 0) {
                                    mainImagePreview.innerHTML = `
                                        <div class="image-preview-item">
                                            <img src="${product.images[0]}" alt="Ana Görsel">
                                            <button type="button" class="image-preview-remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    `;
                                    
                                    // Resmi kaldırma işlevi
                                    mainImagePreview.querySelector('.image-preview-remove').addEventListener('click', function() {
                                        mainImagePreview.innerHTML = '';
                                        document.getElementById('main-image').value = '';
                                    });
                                }
                                
                                // Galeri görselleri (varsa ana görsel dışındakiler)
                                if (product.images.length > 1) {
                                    const galleryImagesPreview = document.getElementById('gallery-images-preview');
                                    if (galleryImagesPreview) {
                                        // Ana görsel dışındaki tüm resimleri ekle
                                        for (let i = 1; i < product.images.length; i++) {
                                            const previewItem = document.createElement('div');
                                            previewItem.className = 'image-preview-item';
                                            previewItem.innerHTML = `
                                                <img src="${product.images[i]}" alt="Galeri Görseli">
                                                <button type="button" class="image-preview-remove">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            `;
                                            
                                            galleryImagesPreview.appendChild(previewItem);
                                            
                                            // Resmi kaldırma işlevi
                                            previewItem.querySelector('.image-preview-remove').addEventListener('click', function() {
                                                previewItem.remove();
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // Düzenleme modunu kontrol et
            checkEditMode();
            
            // SEO karakter sayaçları
            const seoTitle = document.getElementById('product-seo-title');
            const seoDesc = document.getElementById('product-seo-desc');
            const seoTitleCount = document.getElementById('seo-title-count');
            const seoDescCount = document.getElementById('seo-desc-count');
            
            if (seoTitle && seoTitleCount) {
                seoTitle.addEventListener('input', function() {
                    seoTitleCount.textContent = this.value.length;
                });
                // Sayfa yüklendiğinde mevcut karakter sayısını göster
                seoTitleCount.textContent = seoTitle.value.length;
            }
            
            if (seoDesc && seoDescCount) {
                seoDesc.addEventListener('input', function() {
                    seoDescCount.textContent = this.value.length;
                });
                // Sayfa yüklendiğinde mevcut karakter sayısını göster
                seoDescCount.textContent = seoDesc.value.length;
            }
        });
    </script>
</body>
</html> 